<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŸ”å‰£ä¼šè¨ˆã‚¢ãƒ—ãƒª</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>

    <style>
        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            background-color: #f7f9fc;
        }

        .app-container {
            max-width: 100%;
            margin: 0 auto;
            padding-bottom: 70px;
            /* ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã®ã‚¹ãƒšãƒ¼ã‚¹ */
            background-color: white;
            min-height: 100vh;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }

        h1 {
            padding: 20px;
            margin: 0;
            background-color: #3f51b5;
            color: white;
            text-align: center;
        }

        .screen-content {
            padding: 20px;
        }

        .flex-container {
            display: flex;
            gap: 20px;
        }

        .product-select,
        .cart-area {
            width: 50%;
        }

        .product-select {
            border-right: 1px solid #ccc;
            padding-right: 20px;
            width: 50%;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        .product-item {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            background-color: #f9f9f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 4px;
        }

        .product-item:hover {
            background-color: #eef;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }

        .cart-item button {
            margin: 0 5px;
            padding: 3px 8px;
            font-size: 0.9em;
        }

        .total-summary {
            margin-top: 15px;
            padding: 15px;
            background-color: #e8eaf6;
            border-radius: 4px;
        }

        .total-summary h3 {
            color: #d32f2f;
        }

        /* --- ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .taskbar {
            position: fixed;
            bottom: 0;
            width: 100%;
            margin: 0 auto;
            background-color: #ffffff;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-around;
            padding: 5px 0;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .taskbar button {
            background-color: transparent;
            border: none;
            cursor: pointer;
            padding: 5px 15px;
            color: #757575;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: color 0.2s;
        }

        .taskbar button.active {
            color: #3f51b5;
            font-weight: bold;
        }

        .taskbar-icon {
            font-size: 24px;
        }

        .screen {
            display: none;
        }

        /* ãƒ­ã‚°é …ç›®ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
        .log-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
    </style>
</head>

<body>

    <div class="app-container">
        <h1>æŸ”å‰£ä¼šè¨ˆ</h1>
        <hr>

        <div id="checkout-screen" class="screen screen-content">
            <h2>ğŸ’° ä¼šè¨ˆãƒ¬ã‚¸</h2>
            <div class="flex-container">
                <div class="product-select">
                    <h3>å•†å“ãƒªã‚¹ãƒˆ</h3>
                    <ul id="product-list" class="product-list">
                    </ul>
                </div>

                <div class="cart-area">
                    <h3>ã‚«ãƒ¼ãƒˆå†…å®¹</h3>
                    <ul id="cart-list" class="cart-list">
                    </ul>
                    <hr>
                    <div class="total-summary">
                        <p>å£²ã‚ŒãŸå•†å“ã®æ•° (åˆè¨ˆ): <strong id="total-items">0</strong> å€‹</p>
                        <h3><strong>åˆè¨ˆé‡‘é¡:</strong> <span id="total-amount">0</span>å††</h3>
                        <button id="checkout-button" class="btn btn-success mt-2">
                            <i class="bi bi-cart-check"></i> ä¼šè¨ˆå®Œäº†
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="register-screen" class="screen screen-content">
            <h2>ğŸ·ï¸ å•†å“ç™»éŒ²</h2>
            <form id="register-form" class="mb-4">
                <div class="input-group mb-3">
                    <span class="input-group-text"><i class="bi bi-box"></i></span>
                    <input type="text" id="product-name" class="form-control" placeholder="å•†å“å" required>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">Â¥</span>
                    <input type="number" id="product-price" class="form-control" placeholder="ä¾¡æ ¼" required min="1">
                </div>
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-plus-circle"></i> å•†å“ã‚’ç™»éŒ²
                </button>
            </form>

            <h3>ç™»éŒ²æ¸ˆã¿å•†å“ä¸€è¦§</h3>
            <ul id="registered-products" class="list-group">
            </ul>
        </div>
        <div id="log-screen" class="screen screen-content">
            <h3 class="mb-4">ğŸ“œ ä¼šè¨ˆå±¥æ­´ãƒ­ã‚°</h3>

            <div id="log-summary" class="log-total-summary">
                <h3><strong>ç·å£²ã‚Šä¸Šã’: </strong><span id="total-log-amount">0</span>å††</h3>
            </div>
            <ul id="clear-logs-button">
            </ul>
            <ul id="log-list" class="list-group">
            </ul>
        </div>

        <div class="taskbar">
            <button id="nav-checkout" class="active" onclick="showScreen('checkout-screen', this)">
                <span class="taskbar-icon"><i class="bi bi-cash-coin"></i></span>
                <span class="taskbar-label">ãƒ¬ã‚¸ä¼šè¨ˆ</span>
            </button>
            <button id="nav-register" onclick="showScreen('register-screen', this)">
                <span class="taskbar-icon"><i class="bi bi-tags"></i></span>
                <span class="taskbar-label">å•†å“ç™»éŒ²</span>
            </button>
            <button id="nav-log" onclick="showScreen('log-screen', this)">
                <span class="taskbar-icon"><i class="bi bi-journal-text"></i></span>
                <span class="taskbar-label">è³¼å…¥å±¥æ­´</span>
            </button>
        </div>
    </div>

    <script>
        // --- çŠ¶æ…‹ç®¡ç† (Redux/React Stateã®ä»£ã‚ã‚Š) ---
        const STORAGE_KEY = 'jyuukenApp_state';

        let state = {
            products: [],
            cart: [],
            logs: [],
            nextProductId: 1,
            nextLogId: 1
        };

        // --- LocalStorageã‹ã‚‰çŠ¶æ…‹ã‚’ãƒ­ãƒ¼ãƒ‰ ---
        function loadState() {
            const savedState = localStorage.getItem(STORAGE_KEY);
            if (savedState) {
                state = JSON.parse(savedState);
            } else {
                // åˆæœŸå•†å“ã‚’è¿½åŠ 
                state.products = [
                    { id: 1, name: 'ã‚³ãƒ¼ãƒ’ãƒ¼', price: 300 },
                    { id: 2, name: 'ã‚µãƒ³ãƒ‰ã‚¤ãƒƒãƒ', price: 550 },
                ];
                state.nextProductId = 3;
            }
        }

        // --- LocalStorageã«çŠ¶æ…‹ã‚’ä¿å­˜ ---
        function saveState() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }

        // --- ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° ---
        function calculateTotal(cart) {
            const totalAmount = cart.reduce((total, item) => total + item.price * item.quantity, 0);
            const totalItems = cart.reduce((count, item) => count + item.quantity, 0);
            return { totalAmount, totalItems };
        }

        function totalLogAmount() {
            return state.logs.reduce((total, log) => total + log.totalAmount, 0);
        }

        // --- ç”»é¢ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•° ---

        /**
         * å•†å“ãƒªã‚¹ãƒˆã®UIã‚’æ›´æ–°ã™ã‚‹
         */
        function renderProductList() {
            const listEl = document.getElementById('product-list');
            listEl.innerHTML = '';

            state.products.forEach(p => {
                const li = document.createElement('li');
                li.className = 'product-item';
                li.innerHTML = `
                    <span class="product-name"><strong>${p.name}</strong></span>
                    <span class="product-price">${p.price.toLocaleString()}å††</span>
                `;
                li.onclick = () => addToCart(p);
                listEl.appendChild(li);
            });
            renderRegisteredProducts(); // ç™»éŒ²ç”»é¢ã®å•†å“ãƒªã‚¹ãƒˆã‚‚æ›´æ–°
        }

        /**
         * ã‚«ãƒ¼ãƒˆã¨åˆè¨ˆé‡‘é¡ã®UIã‚’æ›´æ–°ã™ã‚‹
         */
        function renderCart() {
            const cartEl = document.getElementById('cart-list');
            const totalAmountEl = document.getElementById('total-amount');
            const totalItemsEl = document.getElementById('total-items');
            const checkoutButton = document.getElementById('checkout-button');

            cartEl.innerHTML = '';

            if (state.cart.length === 0) {
                cartEl.innerHTML = '<p class="text-muted">å•†å“ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                totalAmountEl.textContent = '0';
                totalItemsEl.textContent = '0';
                checkoutButton.disabled = true; // ã‚«ãƒ¼ãƒˆãŒç©ºãªã‚‰ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                return;
            }

            checkoutButton.disabled = false;
            state.cart.forEach(item => {
                const li = document.createElement('li');
                li.className = 'cart-item';
                li.innerHTML = `
                    <span>${item.name} x ${item.quantity}</span>
                    <span>
                        <button class="btn btn-sm btn-outline-secondary" onclick="changeQuantity(${item.id}, -1)">
                            <i class="bi bi-dash"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" onclick="changeQuantity(${item.id}, 1)">
                            <i class="bi bi-plus"></i>
                        </button>
                        <span class="ms-2">${(item.price * item.quantity).toLocaleString()}å††</span>
                    </span>
                `;
                cartEl.appendChild(li);
            });

            const { totalAmount, totalItems } = calculateTotal(state.cart);
            totalAmountEl.textContent = totalAmount.toLocaleString();
            totalItemsEl.textContent = totalItems.toLocaleString();
        }

        /**
         * ãƒ­ã‚°ç”»é¢ã®UIã‚’æ›´æ–°ã™ã‚‹
         */
        function renderLog() {
            const logListEl = document.getElementById('log-list');
            const clearButton = document.getElementById('clear-logs-button');
            const totalLogAmountEl = document.getElementById('total-log-amount');
            logListEl.innerHTML = '';

            // ç·å£²ã‚Šä¸Šã’ã®æ›´æ–°
            const totalBenefit = totalbenefit();
            totalLogAmountEl.textContent = totalBenefit.toLocaleString();

            if (state.logs.length === 0) {
                logListEl.innerHTML = '<p class="text-muted">éå»ã®ä¼šè¨ˆå±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                clearButton.disabled = true;
                return;
            }

            clearButton.disabled = false;

            state.logs.forEach(log => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.style.cssText = 'border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 8px; background-color: #fdfdfd;';

                const innerHTML = `
                    <div class="log-item-header">
                        <div>
                            <strong style="color: #3f51b5;">No.${log.id} - ${log.timestamp}</strong>
                            <br>
                            <strong>åˆè¨ˆ: ${log.totalAmount.toLocaleString()}å†† (${log.totalItems}å€‹)</strong>
                        </div>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteLog(${log.id})">
                            <i class="bi bi-x-lg"></i> å‰Šé™¤
                        </button>
                    </div>
                    <p class="mb-1" style="font-size: 0.9em; font-weight: bold;">å†…è¨³:</p>
                    <ul style="list-style: none; padding-left: 15px; font-size: 0.9em;">
                        ${log.items.map(item => `
                            <li class="d-flex justify-content-between">
                                <span>${item.name} x ${item.quantity}</span>
                                <span>${(item.price * item.quantity).toLocaleString()}å††</span>
                            </li>
                        `).join('')}
                    </ul>
                `;
                li.innerHTML = innerHTML;
                logListEl.appendChild(li);
            });
        }

        /**
         * ç™»éŒ²ç”»é¢ã®å•†å“ãƒªã‚¹ãƒˆã‚’æ›´æ–°ã™ã‚‹
         */
        function renderRegisteredProducts() {
            const listEl = document.getElementById('registered-products');
            listEl.innerHTML = '';

            state.products.forEach(p => {
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex justify-content-between align-items-center';
                li.innerHTML = `
                    <span>${p.name} (${p.price.toLocaleString()}å††)</span>
                    <button class="btn btn-sm btn-danger" onclick="deleteProduct(${p.id})">
                        <i class="bi bi-trash"></i>
                    </button>
                `;
                listEl.appendChild(li);
            });
        }

        // --- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é–¢æ•° (Reducerã®ä»£ã‚ã‚Š) ---

        /**
         * ã‚«ãƒ¼ãƒˆã«å•†å“ã‚’è¿½åŠ ã™ã‚‹
         * @param {object} product - è¿½åŠ ã™ã‚‹å•†å“ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
         */
        function addToCart(product) {
            const existingItem = state.cart.find(item => item.id === product.id);

            if (existingItem) {
                state.cart = state.cart.map(item =>
                    item.id === product.id ? { ...item, quantity: item.quantity + 1 } : item
                );
            } else {
                state.cart.push({ ...product, quantity: 1 });
            }

            updateUI();
        }

        /**
         * ã‚«ãƒ¼ãƒˆå†…ã®æ•°é‡ã‚’å¤‰æ›´ã™ã‚‹
         * @param {number} id - å•†å“ID
         * @param {number} delta - å¤‰æ›´é‡ (+1 or -1)
         */
        function changeQuantity(id, delta) {
            state.cart = state.cart.map(item =>
                item.id === id ? { ...item, quantity: item.quantity + delta } : item
            ).filter(item => item.quantity > 0);

            updateUI();
        }

        /**
         * å•†å“ç™»éŒ²
         */
        function addProduct(name, price) {
            const newProduct = {
                id: state.nextProductId,
                name: name,
                price: price
            };
            state.products.push(newProduct);
            state.nextProductId++;
            updateUI();
        }

        /**
         * å•†å“å‰Šé™¤
         */
        function deleteProduct(id) {
            if (confirm('æœ¬å½“ã«ã“ã®å•†å“ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã‚«ãƒ¼ãƒˆã«å…¥ã£ã¦ã„ã‚‹å ´åˆã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) {
                state.products = state.products.filter(p => p.id !== id);
                state.cart = state.cart.filter(item => item.id !== id);
                updateUI();
            }
        }

        /**
         * ä¼šè¨ˆå®Œäº†å‡¦ç†ï¼ˆãƒ­ã‚°è¨˜éŒ²ã¨ã‚«ãƒ¼ãƒˆã‚¯ãƒªã‚¢ï¼‰
         */
        function completeSale() {
            if (state.cart.length === 0) {
                alert('ã‚«ãƒ¼ãƒˆã«å•†å“ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
                return;
            }

            const { totalAmount, totalItems } = calculateTotal(state.cart);

            const newLog = {
                id: state.nextLogId,
                timestamp: new Date().toLocaleString('ja-JP'),
                items: state.cart.map(item => ({ ...item })), // ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼
                totalAmount: totalAmount,
                totalItems: totalItems,
            };

            state.logs.unshift(newLog); // ãƒ­ã‚°ã‚’å…ˆé ­ã«è¿½åŠ 
            state.cart = []; // ã‚«ãƒ¼ãƒˆã‚’ã‚¯ãƒªã‚¢
            state.nextLogId++;

            alert(`åˆè¨ˆé‡‘é¡ ${totalAmount.toLocaleString()}å††ã§ä¼šè¨ˆã‚’å®Œäº†ã—ã€å±¥æ­´ã«è¨˜éŒ²ã—ã¾ã—ãŸã€‚`);
            updateUI();
        }

        /**
         * å€‹åˆ¥ã®ãƒ­ã‚°ã‚’å‰Šé™¤ã™ã‚‹
         * @param {number} id - å‰Šé™¤ã™ã‚‹ãƒ­ã‚°ã®ID
         */
        function deleteLog(id) {
            if (confirm(`ãƒ­ã‚° No.${id} ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) {
                state.logs = state.logs.filter(log => log.id !== id);
                updateUI();
                renderLog();
            }
        }

        // --- åˆæœŸåŒ–ã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---

        /**
         * å…¨ç”»é¢ã®UIã‚’æ›´æ–°ã—ã€çŠ¶æ…‹ã‚’ä¿å­˜ã™ã‚‹
         */
        function updateUI() {
            renderProductList();
            renderCart();
            renderLog();  // ãƒ­ã‚°ç”»é¢ã‚‚æ›´æ–°ã—ã¦ç·å£²ã‚Šä¸Šã’ã‚’åæ˜ 
            saveState();
        }
        function totalbenefit() {
            const total = state.logs.reduce((sum, log) => sum + log.totalAmount, 0);
            return total;
        }
        // ç”»é¢åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function showScreen(screenId, clickedButton) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById(screenId).style.display = 'block';

            document.querySelectorAll('.taskbar button').forEach(button => {
                button.classList.remove('active');
            });
            clickedButton.classList.add('active');

            // ãƒ­ã‚°ç”»é¢ã«åˆ‡ã‚Šæ›¿ã‚ã£ãŸã¨ãã«ãƒ­ã‚°è¡¨ç¤ºã‚’æ›´æ–°
            if (screenId === 'log-screen') {
                renderLog();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadState(); // çŠ¶æ…‹ã‚’ãƒ­ãƒ¼ãƒ‰
            updateUI();  // åˆå›UIãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ¬ã‚¸ç”»é¢ã‚’è¡¨ç¤º
            showScreen('checkout-screen', document.getElementById('nav-checkout'));

            // å•†å“ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            document.getElementById('register-form').onsubmit = (e) => {
                e.preventDefault();
                const name = document.getElementById('product-name').value;
                const price = parseInt(document.getElementById('product-price').value);

                if (name && price > 0) {
                    addProduct(name, price);
                    document.getElementById('product-name').value = '';
                    document.getElementById('product-price').value = '';
                } else {
                    alert('å•†å“åã¨æœ‰åŠ¹ãªä¾¡æ ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                }
            };

            // ä¼šè¨ˆå®Œäº†ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            document.getElementById('checkout-button').onclick = completeSale;

            // å…¨ã¦å‰Šé™¤ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            // document.getElementById('clear-logs-button').onclick = clearAllLogs;
        });
    </script>
</body>

</html>
